---
title: "Simulation of left truncated normal and estimation of mean and sd for truncated normal distribution"
author: "Shengjia Tu"
date: "6/8/2024"
output:
  rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{Simulation of left truncated normal and estimation of mean and sd for truncated normal distribution}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

```{r echo=FALSE}
library(randomTrunc)
```

# Introduction
The `randomTrunc` package will estimate the mean and standard deviation of the untruncated normal distribution based on the data observed which follows a 3-parameter model or 4-parameter model assumption.

# Density function for known truncation distribution point and untruncated distribution
dtrunc3() and dtrunc4() are used for calculating density for 3-parameter truncation models and 4-parameter truncation models, respectively.

dtrunc3(x, a, mean=0.0, sd=1.0, log = FALSE)

dtrunc4(x, tmean, tsd, mean=0.0, sd=1.0, log = FALSE)

x: truncated data

a: fixed truncation point

mean and sd: mean and sd for untruncated normal distribution

tmean and tsd: mean and sd for normal distribution of the random truncation variate

# Generate random trancated data
rtrunc4() is used for generating random trancated data. You input five parameter values:

rtrunc4(n, tmean, tsd, mean=0.0, sigma=1.0)

n: size of data

tmean and tsd: mean and sd of normal distribution of the random truncation variate

mean and sigma: mean and sd of untruncated normal distribution

Note: You can set tsd=0 for the fixed truncation point for the 3-parameter model.

# maxlik
maxlik() will maximize the log-likelihood and output optimized parameters.

maxlik(x, model = c("three","four"), parm = NULL, ...)

x: observed truncated data

model: specify a 3- or 4-parameter model used

parm: initial values of parameters

Note: you can input 4 parameters for 3-parameter model (should be in order), the function will automatically choose the first, third and fourth parameter in calculation.

# Examples
Here are plots of histograms plus the true density curves generated by dtrunc3() and dtrunc4(). They fit well with each other.
```{r}
hist( rtrunc4( 10000, 1.5, 1e-6, 2.0, 1.0), breaks = 100, freq = FALSE )
curve( dtrunc3( x, 1.5, 2.0, 1.0), 1.49, 5, add = TRUE, col = "red", n = 201)
```


```{r}
hist( rtrunc4( 10000, 1.5, 0.1, 2.0, 1.0), breaks = 100, freq = FALSE )
curve( dtrunc4( x, 1.5, 0.1, 2.0, 1.0), 0, 5, add = TRUE, col = "red")
```

# Perform a simple simulation
Here we show a small simulation as a sample using functions from the `randomTrunc` package.

The true values for simulating 3-parameter truncated model is a=1.5, mu_x=2, sigma_x=1.2. The true values for simulating 4-parameter truncated model is mu_z=1.5, sigma_z=0.1, mu_x=2, sigma_x=1.

The results are very close to true values for both simulations.
```{r}
x <- rtrunc4(10000, 1.5, 1e-6, 2.0, 1.2)
maxlik(x, model = "three", parm = c(1.0, 4, 1.0))
x <- rtrunc4(10000, 1.5, 0.1, 2, 1)
maxlik(x, model = "four", parm = c(1.0, 0.1, 0, 1.0))
# suppressWarnings(maxlik(x, model = "two", parm = c(lst_parm$mu_z[i], lst_parm$sigma_z[i], lst_parm$mu_x[i], lst_parm$sigma_x[i]),a=mu_z))
```


# Acknowledgement

This document depended on the packages

* markdown [@R-markdown]
* knitr [@R-knitr]

and the R environment [@R-man] to get it done.


# References